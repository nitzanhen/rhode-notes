{
  "id": "35",
  "name": "מנמ\"א ממ\"ן 14 שאלה 3",
  "body": "נסמן את קיבולות הכדים האדומים ב-$a_1,...,a_n$, ואת הכחולים ב-$b_1,...,b_n$, בהתאמה.\nפעולת ההשוואה הנתונה מאפשרת להשוות בין הקיבולות של כל זוג $a_i,b_j$, אבל לא בין שני כדים אדומים או שני כחולים.\nנשים לב שההנחות על הכדים אומרות ש-$(b_1,...,b_j)$ מתקבלת באופן יחיד כתמורה של $(a_1,...,a_n)$, שכן לכל $a_i$ מתאים $b_j$ יחיד (והקיבולות של כל הכדים האדומים, או באופן שקול של כל הכחולים, שונות זו מזו).\nהאלגוריתם הרצוי נדרש, בעצם, למצוא את התמורה הזו (ההתאמה בין כל כד אדום לכד הכחול המתאים).\n\n### סעיף א'\nנדרש אלגוריתם דטרמינסיטי שמוצא את הזיווג הנדרש בעזרת $\\Theta(n^2)$ השוואות. אפשר לממש אלגוריתם כזה באופן \"ראש בקיר\" (brute force):\n``` {.numerLines}\nMatch-Naive(A,B)\n  for i ← 1 to n\n    for j ← 1 to n\n      if A[i] = B[j]\n        output (i,j)\n```\n\n(הערה: האלגוריתם מניח שקיבולות הכדים שמורות במערכים $A,B$ (שאורכם $n$), כך ש-$A[i]=a_i,B[j]=b_j$. בנוסף, הכוונה ב-output היא להכריז על הזוג כמתאים, במימוש אפשר היה למשל לאסוף את כל הזוגות למערך ולהחזיר אותו אך זה פחות מהותי רעיונית).\nמההנחות על הכדים, לכל $1\\le i\\le n$ יש אינדקס $1\\le j(i)\\le n$ יחיד כך ש-$a_i=b_{j(i)}$ – האלגוריתם מוצא אותו ע\"י סריקת כל האיברים במערך $B$ עד שהוא מגיע אליו.\n\nבאשר למספר ההשוואות, נשים לב שבגלל שכל תמורה היא הפיכה, לכל $1\\le j\\le n$ יש $i$ יחיד שמתאים לו, ולכן לכל $1\\le j\\le n$ תהיה איטרציה של הלולאה החיצונית שבה הלולאה הפנימית תבצע $j$ השוואות. כל איטרציה של הלולאה הפנימית מבצעת השוואה יחידה, ולכן מספר ההשוואות הכולל הוא\n$$\\sum_{j=1}^n{j}=\\frac{n(n+1)}{2}=\\Theta(n^2)$$\nמשיקולים דומים, סיבוכיות הזמן של האלגוריתם היא $\\Theta(n^2)$. סיבוכיות המקום של האלגוריתם היא $\\Theta(1)$. $\\square$\n\n### סעיף ב'\nנדרש להוכיח חסם תחתון של $\\Omega(n\\log n)$ על מספר ההשוואות שאלגוריתם כנדרש חייב לבצע.\n\nההוכחה דומה מאוד להוכחה שאלגוריתם מיון השוואתי חייב לבצע לפחות $\\Omega(n\\log n)$ השוואות: נבנה עץ החלטה שמתאר את ריצת האלגוריתם על קלט בגודל $n$. בדומה לאלגוריתם מיון, מטרת האלגוריתם כאן היא למצוא תמורה, ולכן העלים יכילו תמורות על $n$ איברים. אלא שכאן, בניגוד לאלגוריתם מיון, התמורה מתאימה בין שני מערכים נתונים שונים (להבדל ממערך והתמורה הממוינת שלו), ולכן כאן הצמתים הפנימיים יכילו זוגות $i:j$, כש-$i,j\\in \\set{1,...,n}$ לאו דווקא שונים, ובו מתבצעת השוואה בין $a_i,b_j$ (ולכל צומת כזה יהיו שני בנים, המתאימים למקרים ש-$a_i\\le b_j,a_i\\gt b_j$).\nכל אלגוריתם נכון, כלומר שאכן פותר את בעיית הזיווג, חייב להיות מסוגל להבחין בין $n!$ התמורות האפשריות, ולכן כל אחת מהן חייבת להופיע בעלה (ויותר מכך, עלה זה חייב להיות נגיש, כלומר המסלול מהשורש אליו חייב לייצג ריצה אפשרית אמיתית של האלגוריתם).\nכעת, נסמן ב-$h$ את גובה העץ; כמו במקרה של מיון השוואה, גודל זה מתאר את מספר ההשוואות המירבי שהאלגוריתם עשוי לבצע עבור קלט באורך $n$ (כלומר את המקרה הגרוע). עץ בינארי בגובה $h$ מכיל לכל היותר $2^h$ עלים, לכן\n$$2^h\\ge n!\\implies h\\ge\\log(n!)=\\Omega(n\\log n)$$\nכנדרש. $\\square$\n\n### סעיף ג'\nנדרש אלגוריתם אקראי שתוחלת מספר ההשוואות בו היא $O(n\\log n)$. \nהאלגוריתם שלהלן שואב השראה ממיון מהיר: נבחר כד אדום $x:=a_i$ באקראי כאיבר הציר, ונחלק את המערך $B$ לשתי פרוסות – של האיברים שקטנים מ-$x$ ואלה שגדולים ממנו – בעזרת וריאציה של האלגוריתם `Partition` מאלגוריתם המיון המהיר. \nאנחנו מניחים שהגרסה של `Partition` שמופיעה כאן מקבלת כארגומנטים איבר ציר ופרוסה מתוך מערך (כלומר את המערך ואינדקסי התחלה וסוף), ושניתן להשוות בין איבר הציר לאיברי הפרוסה, למשל איבר ציר מתוך המערך $A$ ואת המערך $B$ או להפך. אין בכך קושי מהותי, שכן כל ההשוואות במימוש הרגיל של `Partition` מתבצעות ממילא בין איבר הציר ואיברים של המערך. \n\nבתום החלוקה, נקבל שני תת-מערכים $B[1..q-1],B[q+1..n]$, כש-$B[q]=x=a_i$. אחר כך נחלק גם את המערך $A$ בהתאם לערך $x=B[q]$ – בשל ההתאמה החד-חד-ערכית בין קיבולות הכדים האדומים והכחולים, בתום החלוקה נקבל את אותו האינדקס $q$, כלומר יתקיים $B[q]=A[q]=x$, והפרוסות $A[1..q-1],A[q+1..n]$ יכילו את האיברים שקטנים או גדולים מ-$x$, בהתאמה. כעת תנאי הבעיה מתקיימים עבור כל אחד מהזוגות $A[1..q-1],B[1..q-1]$ ו-$A[q+1..n],B[q+1..n]$ בנפרד, וקריאה רקורסיבית לאלגוריתם עבורן תשלים את הזיווג.\n``` {.numberLines}\nMatch(A, B, p, r):\n  if (r ≥ p)\n    i ← Random(p, r)\n    q ← Partition(B, p, r, A[i])\n    Partition(A, p, r, B[q]) ▷ also returns q\n\n    Match(A, B, p, q-1)\n    Match(A, B, q+1, r)\n```\n\n(הערה: בסוף הריצה המערכים $A,B$ יכילו את הזוגות המזווגים, כלומר יתקיים $A[k]=B[k]$ לכל $k$. לכן, אין צורך \"לפלוט\" את הזוגות כמו באלגוריתם מסעיף א')\nהקריאה החיצונית לאלגוריתם היא:\n``` {.numberLines}\nMatch(A, B)\n  n ← length[A] ▷ equal to length[B], by assumption\n  Match(A, B, 1, n)\n```\n\nנשים לב שכל ההשוואות בין הכדים מתבצעות בתוך `Partition`. הניתוח שלה כאן דומה למקרה של מיון מהיר:\nנרשום ב-$z_1\\le z_2\\le ...\\le z_n$ את קיבולות הכדים $\\set{a_1,...,a_n}=\\set{b_1,...,b_n}$, בסדר עולה, וכן $Z_{ij}=\\set{z_i,...,z_j}$ (נשים לב שכאן $i\\le j$, בניגוד למיון מהיר שבו $i,j$ בהכרח שונים).\nתחילה, נשים לב שבכל קריאה ל-`Match`, הערך שנבחר באקראי משמש כציר בשתי החלוקות, במובן שלכדים שמשמשים באיברי הציר בחלוקה של $B$ ואז בזו של $A$ אותה קיבולת. השוואות מתבצעות רק בין איבר ציר לאיבר מהמערך השני, ואחרי שערך מסוים נבחר כציר בקריאה אחת ל-`Match`, הוא לא יופיע באף אחת מהקריאות הבאות (כי הוא לא נכלל באף אחת משני זוגות הפרוסות שנוצרים בחלוקה). לכן, אם מתבצעת בשלב מסוים השוואה בין $z_i,z_j$, אז היא מתבצעת פעמיים באותה קריאה ולא מתבצעת שוב אחר כך. בניסוח אחר, השוואה נתונה מתבצעת פעמיים בדיוק או אפס פעמים.\nלכל $i\\le j$ נסמן ב-$C_{ij}$ את המאורע שנערכת השוואה בין $z_i$ ו-$z_j$, וכן $X_{ij}:=1_{C_{ij}}$. עבור $i=j$, מתקיים $\\PP(C_{ij})=1$, שכן בהכרח מתבצעת השוואה בין איבר הציר שנבחר לכד בצבע האחר עם אותה קיבולת. \nעבור $i\\lt j$, מאותו שיקול שבספר, מתקיימת השוואה בין $z_i,z_j$ אם ורק אם אחד מהם הוא האיבר הראשון שנבחר כציר מתוך $Z_{ij}$; תחת ההנחה שהבחירות אקראיות ובלתי תלויות זו בזו, מתקיים\n$$\\PP(C_{ij})=\\frac{2}{j-i+1}$$\nכעת, נסמן ב-$X$ את מספר ההשוואות הכולל שהאלגוריתם מבצע במהלך הריצה. בין כל זוג איברים $z_i,z_j$, $i\\le j$, מתקיימות $2X_{ij}$ השוואות (כי כאמור אם יש השוואה אחת לפחות אז יש בדיוק שתיים), לכן\n$$X=\\sum_{1\\le i\\le j\\le n}2X_{ij}=2\\sum_{i=1}^{n}\\sum_{j=i}^nX_{ij}$$\nולכן\n$$\\begin{aligned}\n\\EE(X)&=2\\sum_{i=1}^{n}\\sum_{j=i}^n\\EE(X_{ij})=2\\sum_{i=1}^{n}\\sum_{j=i}^n\\PP(C_{ij}) \\\\\n&=2\\sum_{i=1}^n\\PP(C_{ii})+2\\sum_{i=1}^{n-1}\\sum_{j=i+1}^n{\\PP(C_{ij})} \\\\\n&=2n+2\\sum_{i=1}^{n-1}\\sum_{j=i+1}^n{\\frac{2}{j-i+1}}=O(n)+O(n\\log n)\n\\end{aligned}$$\nכשהשוויון הראשון נובע מלינאריות התוחלת, והאחרון מניתוח המיון המהיר בספר (שם מראים שהמחובר השני הוא $O(n\\log n)$). סה\"כ קיבלנו ש-$\\EE(X)=O(n\\log n)$, כנדרש. \n\nבמקרה הגרוע, הדגימות האקראיות כולן מובילות לחלוקות לא מאוזנות, שבהן פרוסה אחת ריקה ופרוסה אחת מכילה את כל האיברים פרט לאיבר הציר. החלוקה בכל מקרה דורשת $\\Theta(n)$ השוואות, ולכן במקרה הזה, כמו במיון מהיר מתקבלת נוסחת הנסיגה\n$$T(n)=T(n-1)+\\Theta(n)$$\nשפתרונה הוא $T(n)=\\Theta(n^2)$. $\\square$"
}